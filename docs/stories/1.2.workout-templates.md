# Story 1.2: Utiliser templates prÃ©-configurÃ©s

## Status
**Draft**

---

## Story

**As a** utilisateur dÃ©butant,  
**I want to** accÃ©der Ã  des templates de sÃ©ances prÃ©-faits,  
**so that** je n'ai pas Ã  crÃ©er mes sÃ©ances from scratch.

---

## Acceptance Criteria

1. 6 templates disponibles dÃ¨s installation (Push, Pull, Legs, Upper, Lower, Full Body)
2. User peut prÃ©visualiser un template avant import
3. User peut importer template et le modifier
4. Templates utilisent exercices de la base prÃ©-chargÃ©e
5. Templates affichÃ©s dans section dÃ©diÃ©e sur home/workout list
6. Import crÃ©e copie modifiable du template

---

## Tasks / Subtasks

### Data Layer - Template Seed
- [ ] **Task 1: Create Template Data** (AC: 1, 4)
  - [ ] Subtask 1.1: Create `assets/data/workout_templates.json`
    - Define 6 templates: Push, Pull, Legs, Upper, Lower, Full Body
    - Each template includes: name, description, exercise list with target sets
    - Use exercise IDs from exercises.json
  - [ ] Subtask 1.2: Template structure
    ```json
    {
      "id": "template-push",
      "name": "Push Day",
      "description": "Chest, Shoulders, Triceps",
      "exercises": [
        {"exerciseId": "bench-press", "targetSets": 4, "restTime": 180},
        {"exerciseId": "overhead-press", "targetSets": 3, "restTime": 180},
        ...
      ],
      "isTemplate": true
    }
    ```
  - [ ] Subtask 1.3: Update `pubspec.yaml` assets (if not already done)

### Use Cases
- [ ] **Task 2: Create Template Use Cases** (AC: 1, 2, 3)
  - [ ] Subtask 2.1: Create `GetWorkoutTemplates` use case in `lib/domain/usecases/get_workout_templates.dart`
    - Load templates from JSON asset
    - Return List<Workout> with isTemplate=true flag
  - [ ] Subtask 2.2: Create `ImportTemplate` use case in `lib/domain/usecases/import_template.dart`
    - Input: templateId
    - Clone template workout
    - Generate new UUID
    - Set isTemplate=false
    - Return new workout
  - [ ] Subtask 2.3: Create `SeedTemplates` use case in `lib/domain/usecases/seed_templates.dart`
    - Check if templates already seeded
    - If not, load from JSON and save to database
    - Mark as templates in database

### State Management (BLoC)
- [ ] **Task 3: Extend WorkoutBloc for Templates** (AC: 1, 2, 5)
  - [ ] Subtask 3.1: Add template events to `workout_event.dart`
    - `LoadTemplates()`, `ImportTemplate(String templateId)`, `SeedTemplatesIfNeeded()`
  - [ ] Subtask 3.2: Update `workout_state.dart`
    - Add `templates` field to WorkoutsLoaded state
    - Distinguish templates from user workouts
  - [ ] Subtask 3.3: Update `workout_bloc.dart`
    - Handle LoadTemplates event
    - Handle ImportTemplate event (clone + save)
    - On app start, seed templates if needed

### UI Layer - Template List
- [ ] **Task 4: Create Template Selection UI** (AC: 2, 5)
  - [ ] Subtask 4.1: Create `TemplateListScreen` in `lib/presentation/screens/templates/template_list_screen.dart`
    - Display list of 6 templates
    - Show template name, description, exercise count
    - Tap template â†’ show preview
  - [ ] Subtask 4.2: Create `TemplateCard` widget in `lib/presentation/widgets/template_card.dart`
    - Display template info
    - Badge "TEMPLATE"
    - Tap to preview

### UI Layer - Template Preview
- [ ] **Task 5: Create Template Preview Screen** (AC: 2, 3)
  - [ ] Subtask 5.1: Create `TemplatePreviewScreen` in `lib/presentation/screens/templates/template_preview_screen.dart`
    - Show template name, description
    - List of exercises with target sets
    - Button: "Use This Template"
    - Button: "Back"
  - [ ] Subtask 5.2: Implement "Use This Template" action
    - Dispatch ImportTemplate event
    - Navigate to WorkoutBuilderScreen with imported workout
    - Allow user to modify before final save

### UI Layer - Integration with Workout List
- [ ] **Task 6: Add Templates Section to Home** (AC: 5)
  - [ ] Subtask 6.1: Update Home/Workout List Screen
    - Section "Templates" at top
    - Horizontal scrollable cards
    - Section "My Workouts" below
  - [ ] Subtask 6.2: Add "Browse Templates" button
    - Navigate to TemplateListScreen
  - [ ] Subtask 6.3: Show template count badge
    - "6 templates available"

### Database Integration
- [ ] **Task 7: Store Templates in Database** (AC: 1, 4)
  - [ ] Subtask 7.1: Add `is_template` column to workouts table
    - ALTER TABLE workouts ADD COLUMN is_template INTEGER DEFAULT 0
  - [ ] Subtask 7.2: Update WorkoutModel to include isTemplate field
  - [ ] Subtask 7.3: Seed templates on first app launch
    - Check if templates exist (count where is_template=1)
    - If 0, load from JSON and insert
  - [ ] Subtask 7.4: Query templates separately from user workouts
    - SELECT * FROM workouts WHERE is_template=1
    - SELECT * FROM workouts WHERE is_template=0

### Testing
- [ ] **Task 8: Unit Tests**
  - [ ] Subtask 8.1: Test `GetWorkoutTemplates` use case
    - Loads 6 templates from JSON
    - Parses correctly
  - [ ] Subtask 8.2: Test `ImportTemplate` use case
    - Clones template
    - Generates new UUID
    - Sets isTemplate=false
  - [ ] Subtask 8.3: Test `SeedTemplates` use case
    - Seeds templates if not exist
    - Doesn't re-seed if already exist
  - [ ] Subtask 8.4: Test WorkoutBloc template events
    - LoadTemplates loads templates
    - ImportTemplate creates new workout

- [ ] **Task 9: Widget Tests**
  - [ ] Subtask 9.1: Test TemplateListScreen renders templates
  - [ ] Subtask 9.2: Test TemplateCard displays info
  - [ ] Subtask 9.3: Test TemplatePreviewScreen shows exercises
  - [ ] Subtask 9.4: Test "Use This Template" creates workout

- [ ] **Task 10: Integration Tests**
  - [ ] Subtask 10.1: Test full flow: Browse templates â†’ Preview â†’ Import â†’ Modify â†’ Save
  - [ ] Subtask 10.2: Test templates persist after app restart

---

## Dev Notes

### Project Structure
**Source:** [PRD Feature 1 - US-1.2]

New/Modified files:
```
lib/
â”œâ”€â”€ domain/
â”‚   â””â”€â”€ usecases/
â”‚       â”œâ”€â”€ get_workout_templates.dart (NEW)
â”‚       â”œâ”€â”€ import_template.dart (NEW)
â”‚       â””â”€â”€ seed_templates.dart (NEW)
â”œâ”€â”€ presentation/
â”‚   â”œâ”€â”€ blocs/workout/
â”‚   â”‚   â”œâ”€â”€ workout_bloc.dart (MODIFY)
â”‚   â”‚   â”œâ”€â”€ workout_event.dart (MODIFY)
â”‚   â”‚   â””â”€â”€ workout_state.dart (MODIFY)
â”‚   â”œâ”€â”€ screens/
â”‚   â”‚   â”œâ”€â”€ templates/
â”‚   â”‚   â”‚   â”œâ”€â”€ template_list_screen.dart (NEW)
â”‚   â”‚   â”‚   â””â”€â”€ template_preview_screen.dart (NEW)
â”‚   â”‚   â””â”€â”€ home/
â”‚   â”‚       â””â”€â”€ home_screen.dart (MODIFY - add templates section)
â”‚   â””â”€â”€ widgets/
â”‚       â””â”€â”€ template_card.dart (NEW)

assets/
â””â”€â”€ data/
    â””â”€â”€ workout_templates.json (NEW)
```

### Template Data Structure
**Source:** [PRD Feature 1 - US-1.2]

**workout_templates.json:**
```json
[
  {
    "id": "template-push",
    "name": "Push Day",
    "description": "Chest, Shoulders, Triceps",
    "exercises": [
      {"exerciseId": "bench-press", "order": 1, "targetSets": 4, "restTime": 180},
      {"exerciseId": "overhead-press", "order": 2, "targetSets": 3, "restTime": 180},
      {"exerciseId": "incline-db-press", "order": 3, "targetSets": 3, "restTime": 120},
      {"exerciseId": "triceps-dips", "order": 4, "targetSets": 3, "restTime": 120},
      {"exerciseId": "lateral-raises", "order": 5, "targetSets": 4, "restTime": 90}
    ],
    "isTemplate": true
  },
  {
    "id": "template-pull",
    "name": "Pull Day",
    "description": "Back, Biceps",
    "exercises": [
      {"exerciseId": "deadlift", "order": 1, "targetSets": 3, "restTime": 240},
      {"exerciseId": "pull-ups", "order": 2, "targetSets": 4, "restTime": 180},
      {"exerciseId": "barbell-rows", "order": 3, "targetSets": 4, "restTime": 180},
      {"exerciseId": "face-pulls", "order": 4, "targetSets": 3, "restTime": 90},
      {"exerciseId": "biceps-curls", "order": 5, "targetSets": 3, "restTime": 90}
    ],
    "isTemplate": true
  },
  {
    "id": "template-legs",
    "name": "Leg Day",
    "description": "Quads, Hamstrings, Glutes, Calves",
    "exercises": [
      {"exerciseId": "squat", "order": 1, "targetSets": 4, "restTime": 240},
      {"exerciseId": "romanian-deadlift", "order": 2, "targetSets": 3, "restTime": 180},
      {"exerciseId": "leg-press", "order": 3, "targetSets": 3, "restTime": 180},
      {"exerciseId": "leg-curls", "order": 4, "targetSets": 3, "restTime": 90},
      {"exerciseId": "calf-raises", "order": 5, "targetSets": 4, "restTime": 60}
    ],
    "isTemplate": true
  },
  {
    "id": "template-upper",
    "name": "Upper Body",
    "description": "Full upper body workout",
    "exercises": [
      {"exerciseId": "bench-press", "order": 1, "targetSets": 4, "restTime": 180},
      {"exerciseId": "barbell-rows", "order": 2, "targetSets": 4, "restTime": 180},
      {"exerciseId": "overhead-press", "order": 3, "targetSets": 3, "restTime": 180},
      {"exerciseId": "pull-ups", "order": 4, "targetSets": 3, "restTime": 120},
      {"exerciseId": "triceps-dips", "order": 5, "targetSets": 3, "restTime": 120}
    ],
    "isTemplate": true
  },
  {
    "id": "template-lower",
    "name": "Lower Body",
    "description": "Full lower body workout",
    "exercises": [
      {"exerciseId": "squat", "order": 1, "targetSets": 4, "restTime": 240},
      {"exerciseId": "deadlift", "order": 2, "targetSets": 3, "restTime": 240},
      {"exerciseId": "leg-press", "order": 3, "targetSets": 3, "restTime": 180},
      {"exerciseId": "lunges", "order": 4, "targetSets": 3, "restTime": 120},
      {"exerciseId": "calf-raises", "order": 5, "targetSets": 4, "restTime": 60}
    ],
    "isTemplate": true
  },
  {
    "id": "template-fullbody",
    "name": "Full Body",
    "description": "Complete full body workout",
    "exercises": [
      {"exerciseId": "squat", "order": 1, "targetSets": 3, "restTime": 240},
      {"exerciseId": "bench-press", "order": 2, "targetSets": 3, "restTime": 180},
      {"exerciseId": "deadlift", "order": 3, "targetSets": 3, "restTime": 240},
      {"exerciseId": "pull-ups", "order": 4, "targetSets": 3, "restTime": 120},
      {"exerciseId": "overhead-press", "order": 5, "targetSets": 3, "restTime": 180}
    ],
    "isTemplate": true
  }
]
```

### Workout Entity Update
**Source:** [PRD Feature 1 - US-1.2]

**Add isTemplate field:**
```dart
class Workout {
  final String id;
  final String name;
  final String? description;
  final List<WorkoutExercise> exercises;
  final String? notes;
  final DateTime createdAt;
  final DateTime updatedAt;
  final bool isTemplate; // NEW field
}
```

### Database Schema Update
**Source:** [PRD Feature 1 - US-1.2]

**Alter workouts table:**
```sql
ALTER TABLE workouts ADD COLUMN is_template INTEGER DEFAULT 0;
CREATE INDEX idx_is_template ON workouts(is_template);
```

### Template Import Logic
**Source:** [PRD Feature 1 - US-1.2 AC]

**ImportTemplate use case:**
1. Load template by ID from database
2. Create new Workout with:
   - New UUID
   - Same name (or append "My " prefix)
   - Same description
   - Copy all exercises
   - isTemplate = false
   - createdAt = now
   - updatedAt = now
3. Save to database
4. Return new workout for editing

**Example:**
- Template: "Push Day"
- Imported: "My Push Day" (editable copy)

### UI/UX Design
**Source:** [PRD Feature 1 - US-1.2]

**Home Screen with Templates:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PFT                       âš™ï¸   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“‹ Workout Templates           â”‚
â”‚  â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”       â”‚
â”‚  â”‚ğŸ“„ â”‚ â”‚ğŸ“„ â”‚ â”‚ğŸ“„ â”‚ â”‚ğŸ“„ â”‚ â†’     â”‚ â† Horizontal scroll
â”‚  â”‚Pshâ”‚ â”‚Pllâ”‚ â”‚Legâ”‚ â”‚Uprâ”‚       â”‚
â”‚  â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜       â”‚
â”‚  [Browse All Templates]         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ’ª My Workouts                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ My Push Day               â”‚ â”‚
â”‚  â”‚ 5 exercises               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Custom Leg Workout        â”‚ â”‚
â”‚  â”‚ 6 exercises               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚
â”‚  [+ Create Workout]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Template Preview Screen:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† Push Day              TEMPLATEâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Chest, Shoulders, Triceps      â”‚
â”‚                                 â”‚
â”‚  Exercises (5):                 â”‚
â”‚  1. Bench Press (4 sets)        â”‚
â”‚  2. Overhead Press (3 sets)     â”‚
â”‚  3. Incline DB Press (3 sets)   â”‚
â”‚  4. Triceps Dips (3 sets)       â”‚
â”‚  5. Lateral Raises (4 sets)     â”‚
â”‚                                 â”‚
â”‚  [  Use This Template  ]        â”‚ â† Primary CTA
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Seeding Logic
**Source:** [PRD Feature 1 - US-1.2 AC]

**On app first launch:**
1. Check template count: `SELECT COUNT(*) FROM workouts WHERE is_template=1`
2. If count = 0:
   - Load workout_templates.json
   - Parse JSON to List<Workout>
   - Insert all with is_template=1
3. If count > 0: Skip (already seeded)

**Trigger:** On app start, after exercise seeding (Story 2.1)

### Integration with Story 3.1
**Source:** [PRD Feature 1 - US-1.2]

**Start Workout flow:**
- User can select template directly from workout selection
- Or select imported (modified) workout
- Templates shown in separate section: "Templates" vs "My Workouts"

### Performance Considerations
**Source:** [PRD Feature 1 - US-1.2]

- **Template load:** < 50ms (6 templates, lightweight)
- **Import operation:** < 100ms (clone + save)
- **Preview rendering:** < 200ms

### Dependencies
**Source:** [PRD Technical Architecture]

Packages (already in project):
- `flutter_bloc: ^8.1.0`
- `sqflite: ^2.3.0`
- `uuid: ^4.0.0`

### Testing Standards

**Unit Test Location:** `test/domain/usecases/`
**Widget Test Location:** `test/presentation/screens/`, `test/presentation/widgets/`
**Integration Test Location:** `integration_test/`
**Coverage Target:** >80%

**Key Test Cases:**
- GetWorkoutTemplates loads 6 templates
- ImportTemplate creates editable copy
- SeedTemplates seeds only once
- Template preview shows correct exercises
- Import flow creates modifiable workout
- Templates persist after app restart

### Integration with Other Stories
**Dependencies:**
- Story 2.1 (Exercises) - Templates use exercise IDs from base

**Enables:**
- Story 3.1 (Start Workout) - Users can start from template
- Easy onboarding for new users

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-11 | 1.0 | Initial story creation from PRD | Mathis (PM) |

---

## Dev Agent Record

### Agent Model Used
_To be filled by dev agent_

### Debug Log References
_To be filled by dev agent_

### Completion Notes List
_To be filled by dev agent_

### File List
_To be filled by dev agent_

---

## QA Results
_To be filled by QA agent_

