# Story 2.1: Accéder à une base d'exercices pré-chargée

## Status
**Draft**

---

## Story

**As a** nouvel utilisateur,  
**I want to** avoir accès à une liste d'exercices dès installation,  
**so that** je peux commencer à tracker sans friction.

---

## Acceptance Criteria

1. 50+ exercices disponibles au premier lancement
2. Exercices catégorisés par groupe musculaire (Chest, Back, Shoulders, Arms, Legs, Core)
3. Exercices taggés: compound/isolation, barbell/dumbbell/machine/bodyweight
4. Chargement depuis fichier JSON au seed initial
5. Performance: liste de 50+ exercices charge en < 100ms

---

## Tasks / Subtasks

### Data Layer - Domain & Models
- [ ] **Task 1: Create Exercise entity and models** (AC: 2, 3)
  - [ ] Subtask 1.1: Create `Exercise` entity in `lib/domain/entities/exercise.dart`
    - Properties: `id` (String UUID), `name` (String), `muscleGroup` (MuscleGroup enum), `category` (ExerciseCategory enum), `equipmentType` (EquipmentType enum), `isCustom` (bool), `instructions` (String?), `createdAt` (DateTime)
  - [ ] Subtask 1.2: Create enums in `lib/domain/entities/exercise_enums.dart`
    - `MuscleGroup`: chest, back, shoulders, arms, legs, core
    - `ExerciseCategory`: compound, isolation
    - `EquipmentType`: barbell, dumbbell, machine, bodyweight, cable
  - [ ] Subtask 1.3: Create `ExerciseModel` in `lib/data/models/exercise_model.dart`
    - Implement `fromJson()`, `toJson()`, `fromEntity()`, `toEntity()` methods
    - Handle enum serialization/deserialization

### Data Source & Repository
- [ ] **Task 2: Implement Exercise Repository** (AC: 1, 4, 5)
  - [ ] Subtask 2.1: Create `ExerciseRepository` interface in `lib/domain/repositories/exercise_repository.dart`
    - Methods: `Future<List<Exercise>> getExercises()`, `Future<Exercise?> getExerciseById(String id)`, `Future<Exercise> createExercise(Exercise exercise)`, `Future<void> deleteExercise(String id)`, `Future<void> seedExercises(List<Exercise> exercises)`
  - [ ] Subtask 2.2: Create `ExerciseLocalDataSource` interface in `lib/data/datasources/local/exercise_local_datasource.dart`
  - [ ] Subtask 2.3: Implement `ExerciseLocalDataSourceImpl` with SQLite operations
    - Create table: `exercises` (id, name, muscle_group, category, equipment_type, is_custom, instructions, created_at)
    - Implement CRUD operations
    - Implement bulk insert for seed data
  - [ ] Subtask 2.4: Implement `ExerciseRepositoryImpl` in `lib/data/repositories/exercise_repository_impl.dart`

### Seed Data
- [ ] **Task 3: Create exercise seed data** (AC: 1, 2, 3, 4)
  - [ ] Subtask 3.1: Create `assets/data/exercises.json` with 50+ exercises
    - Chest: 6 exercises (Barbell Bench Press, Incline Dumbbell Press, Decline Bench Press, Dumbbell Flyes, Cable Flyes, Push-ups)
    - Back: 7 exercises (Deadlift, Barbell Rows, Pull-ups, Lat Pulldown, Seated Cable Rows, T-Bar Rows, Face Pulls)
    - Shoulders: 6 exercises (Overhead Press, Dumbbell Shoulder Press, Lateral Raises, Front Raises, Rear Delt Flyes, Arnold Press)
    - Arms: 6 exercises (Barbell Curls, Hammer Curls, Triceps Dips, Skull Crushers, Cable Triceps Pushdown, Preacher Curls)
    - Legs: 8 exercises (Barbell Squat, Romanian Deadlift, Leg Press, Leg Curls, Leg Extensions, Lunges, Calf Raises, Bulgarian Split Squats)
    - Core: 4 exercises (Plank, Russian Twists, Cable Crunches, Hanging Leg Raises)
  - [ ] Subtask 3.2: Update `pubspec.yaml` to include assets folder
    ```yaml
    flutter:
      assets:
        - assets/data/
    ```
  - [ ] Subtask 3.3: Create `ExerciseSeedService` in `lib/core/services/exercise_seed_service.dart`
    - Load JSON from assets
    - Parse to List<Exercise>
    - Call repository.seedExercises()
    - Handle errors gracefully

### Use Cases
- [ ] **Task 4: Create Exercise Use Cases** (AC: 1, 5)
  - [ ] Subtask 4.1: Create `GetExercises` use case in `lib/domain/usecases/get_exercises.dart`
    - Return all exercises from repository
  - [ ] Subtask 4.2: Create `GetExerciseById` use case in `lib/domain/usecases/get_exercise_by_id.dart`
  - [ ] Subtask 4.3: Create `CreateCustomExercise` use case in `lib/domain/usecases/create_custom_exercise.dart`
    - Validation: name not empty, name unique
    - Set isCustom = true
  - [ ] Subtask 4.4: Create `SeedExercises` use case in `lib/domain/usecases/seed_exercises.dart`
    - Check if exercises already seeded (count > 0)
    - If not, trigger seed service

### State Management (BLoC)
- [ ] **Task 5: Implement ExerciseBloc** (AC: 1, 5)
  - [ ] Subtask 5.1: Create ExerciseBloc events in `lib/presentation/blocs/exercise/exercise_event.dart`
    - `LoadExercises`, `CreateCustomExercise`, `DeleteCustomExercise`, `SeedExercisesIfNeeded`
  - [ ] Subtask 5.2: Create ExerciseBloc states in `lib/presentation/blocs/exercise/exercise_state.dart`
    - `ExerciseInitial`, `ExerciseLoading`, `ExercisesLoaded`, `ExerciseError`
  - [ ] Subtask 5.3: Implement ExerciseBloc logic in `lib/presentation/blocs/exercise/exercise_bloc.dart`
    - Handle all events and emit appropriate states
    - On app start, trigger SeedExercisesIfNeeded event

### App Initialization
- [ ] **Task 6: Integrate exercise seeding on app start** (AC: 1, 4)
  - [ ] Subtask 6.1: Update `main.dart` to initialize ExerciseBloc
  - [ ] Subtask 6.2: Add SeedExercisesIfNeeded event dispatch on app start
  - [ ] Subtask 6.3: Add loading indicator while seeding (first launch only)
  - [ ] Subtask 6.4: Handle seed failure gracefully (retry mechanism)

### UI Layer (Basic List View)
- [ ] **Task 7: Create Exercise List Screen** (AC: 1, 2, 3, 5)
  - [ ] Subtask 7.1: Create `ExerciseListScreen` in `lib/presentation/screens/exercise_list/exercise_list_screen.dart`
    - Display list of exercises grouped by muscle group
    - Show exercise name, category badge, equipment icon
    - Performance: use ListView.builder for efficient rendering
  - [ ] Subtask 7.2: Create `ExerciseListItem` widget in `lib/presentation/widgets/exercise_list_item.dart`
    - Display exercise name
    - Display muscle group badge/chip
    - Display category (compound/isolation) badge
    - Display equipment type icon
    - Tap to select (context-dependent)

### Testing
- [ ] **Task 8: Unit Tests**
  - [ ] Subtask 8.1: Test `Exercise` entity creation
  - [ ] Subtask 8.2: Test `ExerciseModel` JSON serialization/deserialization
  - [ ] Subtask 8.3: Test enum parsing (MuscleGroup, ExerciseCategory, EquipmentType)
  - [ ] Subtask 8.4: Test `ExerciseRepositoryImpl` CRUD operations
  - [ ] Subtask 8.5: Test `ExerciseSeedService` JSON loading and parsing
  - [ ] Subtask 8.6: Test `SeedExercises` use case (already seeded vs not seeded)
  - [ ] Subtask 8.7: Test `ExerciseBloc` event handling and state transitions

- [ ] **Task 9: Widget Tests**
  - [ ] Subtask 9.1: Test `ExerciseListScreen` renders correctly with exercises
  - [ ] Subtask 9.2: Test `ExerciseListItem` displays all information correctly
  - [ ] Subtask 9.3: Test loading state shows loading indicator

- [ ] **Task 10: Integration Test**
  - [ ] Subtask 10.1: Test full flow: app start → seed exercises → load exercises → display list
  - [ ] Subtask 10.2: Verify performance: loading 50+ exercises < 100ms

---

## Dev Notes

### Project Structure
**Source:** [PRD Feature 2 - Technical Specifications]

This story implements the Exercise domain following Clean Architecture:

```
lib/
├── core/
│   └── services/
│       └── exercise_seed_service.dart
├── domain/
│   ├── entities/
│   │   ├── exercise.dart
│   │   └── exercise_enums.dart
│   ├── repositories/
│   │   └── exercise_repository.dart
│   └── usecases/
│       ├── get_exercises.dart
│       ├── get_exercise_by_id.dart
│       ├── create_custom_exercise.dart
│       └── seed_exercises.dart
├── data/
│   ├── models/
│   │   └── exercise_model.dart
│   ├── datasources/local/
│   │   ├── exercise_local_datasource.dart
│   │   └── exercise_local_datasource_impl.dart
│   └── repositories/
│       └── exercise_repository_impl.dart
└── presentation/
    ├── blocs/exercise/
    │   ├── exercise_bloc.dart
    │   ├── exercise_event.dart
    │   └── exercise_state.dart
    ├── screens/exercise_list/
    │   └── exercise_list_screen.dart
    └── widgets/
        └── exercise_list_item.dart

assets/
└── data/
    └── exercises.json
```

### Data Models
**Source:** [PRD Feature 2 - Technical Specifications]

**Exercise Entity:**
```dart
class Exercise {
  final String id; // UUID
  final String name;
  final MuscleGroup muscleGroup;
  final ExerciseCategory category; // compound/isolation
  final EquipmentType equipmentType;
  final bool isCustom;
  final String? instructions;
  final DateTime createdAt;
}
```

**Enums:**
```dart
enum MuscleGroup {
  chest, back, shoulders, arms, legs, core
}

enum ExerciseCategory {
  compound, isolation
}

enum EquipmentType {
  barbell, dumbbell, machine, bodyweight, cable
}
```

### Database Schema
**Source:** [PRD Feature 2 - Technical Specifications]

**Table: exercises**
- `id` TEXT PRIMARY KEY
- `name` TEXT NOT NULL UNIQUE
- `muscle_group` TEXT NOT NULL
- `category` TEXT NOT NULL
- `equipment_type` TEXT NOT NULL
- `is_custom` INTEGER NOT NULL (0 or 1)
- `instructions` TEXT
- `created_at` INTEGER NOT NULL

**Indexes:**
- CREATE INDEX idx_muscle_group ON exercises(muscle_group)
- CREATE INDEX idx_is_custom ON exercises(is_custom)

### Seed Data Format
**Source:** [PRD Feature 2 - US-2.1]

`assets/data/exercises.json`:
```json
[
  {
    "id": "uuid-1",
    "name": "Barbell Bench Press",
    "muscleGroup": "chest",
    "category": "compound",
    "equipmentType": "barbell",
    "isCustom": false,
    "instructions": null,
    "createdAt": "2026-01-01T00:00:00.000Z"
  },
  ...
]
```

### Exercise List (50+ exercises)
**Source:** [PRD Feature 2 - US-2.1]

**Chest (6):**
- Barbell Bench Press, Incline Dumbbell Press, Decline Bench Press, Dumbbell Flyes, Cable Flyes, Push-ups

**Back (7):**
- Deadlift, Barbell Rows, Pull-ups, Lat Pulldown, Seated Cable Rows, T-Bar Rows, Face Pulls

**Shoulders (6):**
- Overhead Press, Dumbbell Shoulder Press, Lateral Raises, Front Raises, Rear Delt Flyes, Arnold Press

**Arms (6):**
- Barbell Curls, Hammer Curls, Triceps Dips, Skull Crushers, Cable Triceps Pushdown, Preacher Curls

**Legs (8):**
- Barbell Squat, Romanian Deadlift, Leg Press, Leg Curls, Leg Extensions, Lunges, Calf Raises, Bulgarian Split Squats

**Core (4):**
- Plank, Russian Twists, Cable Crunches, Hanging Leg Raises

**Total: 37 base exercises** (add 13+ more variations to reach 50+)

### BLoC Architecture
**Source:** [PRD Feature 2 - Technical Specifications]

**Events:**
- `LoadExercises` - Load all exercises
- `CreateCustomExercise` - Create custom exercise (Story 2.3)
- `DeleteCustomExercise` - Delete custom exercise (Story 2.3)
- `SeedExercisesIfNeeded` - Trigger seed if database empty

**States:**
- `ExerciseInitial` - Initial state
- `ExerciseLoading` - Loading exercises
- `ExercisesLoaded` - Exercises loaded (contains List<Exercise>)
- `ExerciseError` - Error occurred (contains error message)

### Seeding Logic
**Source:** [PRD Feature 2 - US-2.1 AC]

1. On app start, ExerciseBloc checks if exercises exist (count > 0)
2. If count = 0, load `assets/data/exercises.json`
3. Parse JSON to List<Exercise>
4. Bulk insert into SQLite (use transaction for performance)
5. Emit `ExercisesLoaded` state
6. Performance target: < 100ms for 50+ exercises

### Dependencies
**Source:** [PRD Technical Architecture]

Required packages (add to `pubspec.yaml` if not already present):
- `flutter_bloc: ^8.1.0` - State management
- `sqflite: ^2.3.0` - Local database
- `get_it: ^7.6.0` - Dependency injection
- `uuid: ^4.0.0` - Generate UUIDs
- `equatable: ^2.0.5` - Value equality

### Performance Considerations
**Source:** [PRD Feature 2 - US-2.1 AC]

- Use `ListView.builder` for efficient list rendering
- Use database indexes on `muscle_group` and `is_custom`
- Bulk insert seed data in single transaction
- Target: Load 50+ exercises in < 100ms

### Integration with Story 1.1
**Note:** Story 1.1 (Create Workout) depends on this story for selecting exercises. Once this story is complete, Story 1.1's exercise picker can be fully implemented.

### Testing Standards

**Unit Test Location:** `test/domain/usecases/`, `test/data/repositories/`, `test/core/services/`
**Widget Test Location:** `test/presentation/screens/`
**Integration Test Location:** `integration_test/`
**Coverage Target:** >80%

**Testing Framework:** 
- `flutter_test` for unit and widget tests
- `bloc_test` for BLoC testing
- `mockito` or `mocktail` for mocking

**Key Test Cases:**
- Enum serialization/deserialization
- JSON parsing from assets
- Seed service error handling
- BLoC state transitions (especially SeedExercisesIfNeeded)
- Performance test: loading 50+ exercises

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-11 | 1.0 | Initial story creation from PRD | Mathis (PM) |

---

## Dev Agent Record

### Agent Model Used
_To be filled by dev agent_

### Debug Log References
_To be filled by dev agent_

### Completion Notes List
_To be filled by dev agent_

### File List
_To be filled by dev agent_

---

## QA Results
_To be filled by QA agent_

