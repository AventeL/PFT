# Story 0: UX Polish - Animations & Loading States

## Status
**Draft - Cross-Cutting Concern**

---

## Story

**As a** utilisateur,  
**I want to** une expérience fluide et agréable avec des animations et des états de chargement clairs,  
**so that** l'application soit plaisante à utiliser sans être gênante.

---

## Acceptance Criteria

1. **Tous les chargements** utilisent des shimmer effects ou skeletons (pas de spinners simples)
2. **Animations de transition** entre écrans (smooth, < 300ms)
3. **Animations micro-interactions** (tap, swipe, expand/collapse)
4. **Animations non-bloquantes** (n'empêchent pas l'utilisation)
5. **Loading states visuellement attractifs** (placeholder content)
6. **Animations cohérentes** à travers toute l'app
7. **60 FPS garanti** sur animations critiques

---

## Tasks / Subtasks

### Loading States - Shimmer Effects
- [ ] **Task 1: Create Shimmer Widget Library** (AC: 1, 5)
  - [ ] Subtask 1.1: Add `shimmer: ^3.0.0` package to pubspec.yaml
  - [ ] Subtask 1.2: Create `ShimmerWidget` base component in `lib/presentation/widgets/shimmer/shimmer_widget.dart`
    - Configurable: width, height, borderRadius
    - Animated gradient shimmer effect
    - Colors match app theme
  - [ ] Subtask 1.3: Create specific shimmer components:
    - `ExerciseListShimmer` - Skeleton for exercise list
    - `WorkoutListShimmer` - Skeleton for workout cards
    - `HistoryListShimmer` - Skeleton for history items
    - `SessionDetailsShimmer` - Skeleton for session details screen
    - `StatsCardShimmer` - Skeleton for stats cards

### Loading States - Skeleton Screens
- [ ] **Task 2: Implement Skeleton Screens** (AC: 1, 5)
  - [ ] Subtask 2.1: Create skeleton layouts matching actual content
    - Show placeholder boxes where content will appear
    - Maintain layout structure (no layout shift)
  - [ ] Subtask 2.2: Replace CircularProgressIndicator with skeletons:
    - Exercise list loading
    - Workout list loading
    - History list loading
    - Session details loading
    - Stats loading
  - [ ] Subtask 2.3: Add shimmer animation to skeletons
    - Smooth left-to-right shimmer
    - Loop continuously until content loads

### Screen Transitions
- [ ] **Task 3: Implement Smooth Screen Transitions** (AC: 2, 4)
  - [ ] Subtask 3.1: Use custom route transitions instead of default
    - Slide transitions for hierarchical navigation
    - Fade transitions for tab changes
    - Scale transitions for dialogs/bottom sheets
  - [ ] Subtask 3.2: Create custom route transition helpers in `lib/core/navigation/transitions.dart`:
    - `slideRightRoute()` - Slide from right (standard push)
    - `slideUpRoute()` - Slide from bottom (sheets)
    - `fadeRoute()` - Fade in/out
    - `scaleRoute()` - Scale with fade
  - [ ] Subtask 3.3: Apply transitions to key navigations:
    - Home → Workout Builder
    - Workout List → Active Workout
    - History → Session Details
    - Exercise List → Exercise Details
  - [ ] Subtask 3.4: Duration optimization
    - Fast transitions: 250ms for frequent actions
    - Medium transitions: 300ms for standard navigation
    - Never > 400ms

### Micro-Interactions - Tap Feedback
- [ ] **Task 4: Implement Tap Animations** (AC: 3, 4)
  - [ ] Subtask 4.1: Add InkWell/InkResponse to all tappable items
    - Ripple effect on tap
    - Splash color matches theme
  - [ ] Subtask 4.2: Add scale animation on button press
    - Scale down to 0.95 on press
    - Scale back to 1.0 on release
    - Duration: 100ms (quick feedback)
  - [ ] Subtask 4.3: Add subtle bounce on FAB tap
    - Scale animation with overshoot
    - Makes "Start Workout" button feel responsive

### Micro-Interactions - Swipe Gestures
- [ ] **Task 5: Implement Swipe Animations** (AC: 3, 4)
  - [ ] Subtask 5.1: Smooth swipe-to-delete animation
    - Item slides with finger
    - Delete icon reveals underneath
    - Fade out on confirm delete
  - [ ] Subtask 5.2: Reorder animation (drag & drop)
    - Item lifts with elevation on long press
    - Other items animate to make space
    - Smooth drop animation

### Micro-Interactions - Expand/Collapse
- [ ] **Task 6: Implement Expand/Collapse Animations** (AC: 3, 4)
  - [ ] Subtask 6.1: Animated expand for exercise details
    - Smooth height animation (AnimatedSize)
    - Chevron rotates 180°
    - Content fades in
  - [ ] Subtask 6.2: Animated filter chips selection
    - Scale up slightly on select
    - Color transition (smooth)
  - [ ] Subtask 6.3: Stats card expand
    - Height animation for detailed view
    - Chart fade in

### List Animations
- [ ] **Task 7: Implement List Item Animations** (AC: 3, 6)
  - [ ] Subtask 7.1: Staggered fade-in for lists
    - Items appear one by one (quick stagger)
    - Use AnimatedList or custom animation
  - [ ] Subtask 7.2: Add/remove animations
    - New workout appears with scale + fade
    - Deleted workout fades out + shrinks
  - [ ] Subtask 7.3: Smooth scroll behavior
    - Physics-based scrolling
    - Overscroll glow matching theme

### PR Celebration Animation
- [ ] **Task 8: Enhance PR Celebration** (AC: 3, 4)
  - [ ] Subtask 8.1: Confetti animation already in Story 6.2
    - Ensure non-blocking
    - Duration: 2-3 seconds
  - [ ] Subtask 8.2: Add trophy badge scale animation
    - Trophy icon bounces in
    - Scale overshoot effect
    - Glowing pulse animation (subtle)
  - [ ] Subtask 8.3: Add haptic feedback (already in Story 6.2)
    - HeavyImpact on PR

### Timer Overlay Animations
- [ ] **Task 9: Animate Timer Overlay** (AC: 2, 3)
  - [ ] Subtask 9.1: Timer overlay fade in
    - Fade + scale from center
    - Duration: 200ms
  - [ ] Subtask 9.2: Countdown number pulse
    - Subtle scale animation every second
    - More pronounced at 10s warning
  - [ ] Subtask 9.3: Completion animation
    - Timer completes → fade out
    - Confetti (Story 4.2)
    - Return to workout screen (smooth transition)

### Form Field Animations
- [ ] **Task 10: Animate Form Interactions** (AC: 3)
  - [ ] Subtask 10.1: TextField focus animation
    - Border color transition
    - Label moves up (Material standard)
  - [ ] Subtask 10.2: Error shake animation
    - TextField shakes on validation error
    - Red color fade in
  - [ ] Subtask 10.3: Success checkmark
    - Checkmark animates in on successful save
    - Green fade

### Performance Optimization
- [ ] **Task 11: Ensure 60 FPS** (AC: 7)
  - [ ] Subtask 11.1: Use RepaintBoundary for complex widgets
    - Isolate animated widgets
    - Reduce rebuild scope
  - [ ] Subtask 11.2: Optimize shimmer animations
    - Use CustomPainter for shimmer gradient
    - Cache where possible
  - [ ] Subtask 11.3: Profile animations with DevTools
    - Check frame rendering times
    - Optimize slow animations
  - [ ] Subtask 11.4: Reduce overdraw
    - Clip children where needed
    - Avoid unnecessary transparency layers

### Animation Guidelines Document
- [ ] **Task 12: Create Animation Guidelines** (AC: 6)
  - [ ] Subtask 12.1: Document animation standards
    - Duration ranges (fast: 100-200ms, medium: 200-300ms, slow: 300-400ms)
    - Curves to use (easeInOut, easeOut, bounceOut, etc.)
    - When to animate vs when not to
  - [ ] Subtask 12.2: Create reusable animation utilities
    - `AnimationUtils` class with common animations
    - Predefined curves and durations
  - [ ] Subtask 12.3: Document in `docs/UX_GUIDELINES.md`

### Testing
- [ ] **Task 13: Test Animations** (AC: 4, 7)
  - [ ] Subtask 13.1: Manual testing on physical device
    - Verify 60 FPS on animations
    - Check smoothness
    - Ensure no jank
  - [ ] Subtask 13.2: Test animation interruptions
    - User can interact during animations
    - Animations don't block UI
  - [ ] Subtask 13.3: Test on low-end devices
    - Ensure acceptable performance
    - Disable complex animations if needed

---

## Dev Notes

### Project Structure
**Source:** [Request: UX Polish]

New files:
```
lib/
├── core/
│   ├── navigation/
│   │   └── transitions.dart (NEW)
│   └── utils/
│       └── animation_utils.dart (NEW)
└── presentation/
    └── widgets/
        ├── shimmer/
        │   ├── shimmer_widget.dart (NEW)
        │   ├── exercise_list_shimmer.dart (NEW)
        │   ├── workout_list_shimmer.dart (NEW)
        │   ├── history_list_shimmer.dart (NEW)
        │   └── stats_card_shimmer.dart (NEW)
        └── animated/
            ├── animated_button.dart (NEW)
            ├── animated_list_item.dart (NEW)
            └── scale_tap.dart (NEW)

docs/
└── UX_GUIDELINES.md (NEW)
```

### Shimmer Package
**Source:** Industry Best Practice

**Package:** `shimmer: ^3.0.0`

**Basic shimmer effect:**
```dart
Shimmer.fromColors(
  baseColor: Colors.grey[300]!,
  highlightColor: Colors.grey[100]!,
  child: Container(
    width: 200,
    height: 20,
    color: Colors.white,
  ),
);
```

### Skeleton Screen Example
**Source:** Material Design Guidelines

**Exercise List Skeleton:**
```dart
class ExerciseListShimmer extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return ListView.builder(
      itemCount: 6, // Show 6 placeholder items
      itemBuilder: (context, index) => Padding(
        padding: EdgeInsets.all(8.0),
        child: Shimmer.fromColors(
          baseColor: Colors.grey[300]!,
          highlightColor: Colors.grey[100]!,
          child: Row(
            children: [
              Container(width: 50, height: 50, color: Colors.white), // Icon
              SizedBox(width: 12),
              Expanded(
                child: Column(
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: [
                    Container(width: double.infinity, height: 16, color: Colors.white), // Name
                    SizedBox(height: 8),
                    Container(width: 100, height: 12, color: Colors.white), // Category
                  ],
                ),
              ),
            ],
          ),
        ),
      ),
    );
  }
}
```

### Screen Transition Examples
**Source:** Flutter Material/Cupertino**

**Slide Transition:**
```dart
Route slideRightRoute(Widget page) {
  return PageRouteBuilder(
    pageBuilder: (context, animation, secondaryAnimation) => page,
    transitionsBuilder: (context, animation, secondaryAnimation, child) {
      const begin = Offset(1.0, 0.0);
      const end = Offset.zero;
      const curve = Curves.easeInOut;
      var tween = Tween(begin: begin, end: end).chain(CurveTween(curve: curve));
      var offsetAnimation = animation.drive(tween);
      return SlideTransition(position: offsetAnimation, child: child);
    },
    transitionDuration: Duration(milliseconds: 250),
  );
}
```

**Usage:**
```dart
Navigator.of(context).push(slideRightRoute(WorkoutBuilderScreen()));
```

### Micro-Interaction: Scale Tap
**Source:** iOS Human Interface Guidelines**

**Animated button with scale:**
```dart
class ScaleTap extends StatefulWidget {
  final Widget child;
  final VoidCallback onTap;
  
  @override
  _ScaleTapState createState() => _ScaleTapState();
}

class _ScaleTapState extends State<ScaleTap> with SingleTickerProviderStateMixin {
  late AnimationController _controller;
  
  @override
  void initState() {
    super.initState();
    _controller = AnimationController(
      vsync: this,
      duration: Duration(milliseconds: 100),
      lowerBound: 0.95,
      upperBound: 1.0,
    )..value = 1.0;
  }
  
  @override
  Widget build(BuildContext context) {
    return GestureDetector(
      onTapDown: (_) => _controller.reverse(),
      onTapUp: (_) {
        _controller.forward();
        widget.onTap();
      },
      onTapCancel: () => _controller.forward(),
      child: ScaleTransition(
        scale: _controller,
        child: widget.child,
      ),
    );
  }
}
```

### Animation Duration Guidelines
**Source:** Material Motion**

**Standard durations:**
- **Micro (100-200ms):** Button taps, ripples, checkbox toggle
- **Standard (200-300ms):** Screen transitions, expand/collapse, fade
- **Slow (300-400ms):** Complex transitions, dramatic effects
- **Never > 400ms:** Feels sluggish

**Recommended curves:**
- **easeInOut:** Balanced, most versatile
- **easeOut:** Decelerating, natural feel
- **bounceOut:** Playful, attention-grabbing
- **fastOutSlowIn:** Material standard

### Staggered List Animation
**Source:** Flutter Animations**

```dart
class StaggeredList extends StatelessWidget {
  final List<Widget> children;
  
  @override
  Widget build(BuildContext context) {
    return ListView.builder(
      itemCount: children.length,
      itemBuilder: (context, index) {
        return AnimatedBuilder(
          animation: _controller,
          builder: (context, child) {
            final delay = index * 0.05; // 50ms stagger per item
            final progress = (_controller.value - delay).clamp(0.0, 1.0);
            return Opacity(
              opacity: progress,
              child: Transform.translate(
                offset: Offset(0, 20 * (1 - progress)),
                child: child,
              ),
            );
          },
          child: children[index],
        );
      },
    );
  }
}
```

### Performance Best Practices
**Source:** Flutter Performance**

**60 FPS essentials:**
1. **Use const constructors** where possible
2. **RepaintBoundary** for complex animated widgets
3. **Avoid rebuilding entire tree** (use BLoC selectively)
4. **Preload images** to avoid jank
5. **Profile with DevTools** to identify bottlenecks

### Non-Blocking Animations
**Source:** UX Best Practice**

**Key principle:** Animations should NEVER prevent user interaction

**Examples:**
- ✅ User can tap "Skip" timer while confetti animates
- ✅ User can scroll list while items fade in
- ✅ User can navigate away during loading shimmer
- ❌ Modal loading that blocks entire screen

**Implementation:**
- Use Overlay for non-blocking effects
- Allow gestures during animations
- Provide cancel/skip options

### Dependencies
**Source:** Flutter Ecosystem**

New package:
- `shimmer: ^3.0.0` - Shimmer loading effect

Existing packages:
- Built-in Flutter animations (AnimatedContainer, Hero, etc.)

### Testing Standards

**Manual Testing Required:**
- Animations feel smooth (60 FPS)
- No jank on physical devices
- Animations don't block interactions
- Loading states clear and attractive

**Performance Testing:**
- Profile with Flutter DevTools
- Check frame rendering times
- Test on low-end devices (Android mid-range)

### Integration Across All Stories

**This story is cross-cutting:**
- Applies to ALL screens and features
- Implemented alongside each feature story
- Consistent throughout app

**Priority for animations:**
1. **High:** Loading states, screen transitions, button taps
2. **Medium:** List animations, expand/collapse
3. **Low:** Decorative animations (confetti, etc.)

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-11 | 1.0 | Initial story creation from user request | Mathis (PM) |

---

## Dev Agent Record

### Agent Model Used
_To be filled by dev agent_

### Debug Log References
_To be filled by dev agent_

### Completion Notes List
_To be filled by dev agent_

### File List
_To be filled by dev agent_

---

## QA Results
_To be filled by QA agent_

