# Story 1.5: Ajouter notes aux sÃ©ances

## Status
**Draft**

---

## Story

**As a** utilisateur,  
**I want to** ajouter des notes Ã  mes sÃ©ances,  
**so that** je peux documenter mes ressentis, conditions, etc.

---

## Acceptance Criteria

1. Champ texte "Notes" dans workout editor (create/edit)
2. Notes sauvegardÃ©es avec la sÃ©ance template
3. Notes visibles en preview de la sÃ©ance
4. Character limit: 500 caractÃ¨res
5. Notes optionnelles (peuvent Ãªtre vides)
6. Notes affichÃ©es dans workout list (preview ou icÃ´ne)

---

## Tasks / Subtasks

### Data Model (Already Exists)
- [ ] **Task 1: Verify Workout Entity Has Notes Field** (AC: 2)
  - [ ] Subtask 1.1: Verify `Workout` entity has `notes` field
    - Already defined: `final String? notes;`
  - [ ] Subtask 1.2: Verify WorkoutModel serialization
    - toJson/fromJson handles notes field
  - [ ] Subtask 1.3: Verify database schema
    - Column `notes TEXT` exists in workouts table

### UI Layer - Workout Builder
- [ ] **Task 2: Add Notes Field to Workout Builder** (AC: 1, 4, 5)
  - [ ] Subtask 2.1: Add notes TextField to `WorkoutBuilderScreen`
    - Position: Below description field
    - Label: "Notes (Optional)"
    - Multiline: true (3-5 lines visible)
    - Max length: 500 characters
    - Character counter: "0/500"
  - [ ] Subtask 2.2: Implement character limit validation
    - Input formatter: MaxLengthTextInputFormatter(500)
    - Visual counter updates in real-time
  - [ ] Subtask 2.3: Save notes with workout
    - Include notes in CreateWorkout/UpdateWorkout events
    - Persist to database

### UI Layer - Workout List
- [ ] **Task 3: Display Notes in Workout List** (AC: 3, 6)
  - [ ] Subtask 3.1: Update `WorkoutListItem` widget
    - If notes present: Show preview (first 50 chars) or icon
    - Icon: ğŸ“ or note icon
    - Preview format: "Notes: [first 50 chars]..."
  - [ ] Subtask 3.2: Full notes on tap/expansion
    - Expandable list item or navigate to details
    - Show full notes text

### UI Layer - Workout Preview
- [ ] **Task 4: Show Notes in Workout Preview** (AC: 3)
  - [ ] Subtask 4.1: When previewing workout before starting session
    - Display notes in dedicated section
    - Label: "Notes"
    - Scrollable if long
  - [ ] Subtask 4.2: Styling
    - Card or container
    - Italic text or distinct styling
    - Icon for visual separation

### Testing
- [ ] **Task 5: Unit Tests**
  - [ ] Subtask 5.1: Test WorkoutModel notes serialization
    - toJson includes notes
    - fromJson parses notes
    - Handles null notes
  - [ ] Subtask 5.2: Test CreateWorkout with notes
  - [ ] Subtask 5.3: Test UpdateWorkout updates notes

- [ ] **Task 6: Widget Tests**
  - [ ] Subtask 6.1: Test notes field renders in builder
  - [ ] Subtask 6.2: Test character counter updates
  - [ ] Subtask 6.3: Test max length enforcement
  - [ ] Subtask 6.4: Test notes display in list
  - [ ] Subtask 6.5: Test notes preview truncation

- [ ] **Task 7: Integration Tests**
  - [ ] Subtask 7.1: Test create workout with notes â†’ Save â†’ Notes persist
  - [ ] Subtask 7.2: Test edit notes â†’ Save â†’ Notes updated
  - [ ] Subtask 7.3: Test notes display in list and preview

---

## Dev Notes

### Project Structure
**Source:** [PRD Feature 1 - US-1.5]

Modified files:
```
lib/
â”œâ”€â”€ domain/
â”‚   â””â”€â”€ entities/
â”‚       â””â”€â”€ workout.dart (VERIFY - notes field exists)
â”œâ”€â”€ presentation/
â”‚   â”œâ”€â”€ screens/
â”‚   â”‚   â””â”€â”€ workout_builder/
â”‚   â”‚       â””â”€â”€ workout_builder_screen.dart (MODIFY - add notes field)
â”‚   â””â”€â”€ widgets/
â”‚       â””â”€â”€ workout_list_item.dart (MODIFY - display notes preview)
```

### Workout Entity (Already Defined)
**Source:** [PRD Feature 1 - Technical Specifications]

```dart
class Workout {
  final String id;
  final String name;
  final String? description;
  final List<WorkoutExercise> exercises;
  final String? notes; // ALREADY EXISTS
  final DateTime createdAt;
  final DateTime updatedAt;
  final bool isTemplate;
}
```

**Note:** This field already exists from Story 1.1. This story adds UI to use it.

### Notes Field UI Design
**Source:** [PRD Feature 1 - US-1.5 AC]

**In Workout Builder:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Workout Name *                 â”‚
â”‚  [Push Day____________]         â”‚
â”‚                                 â”‚
â”‚  Description                    â”‚
â”‚  [Chest, Shoulders, Triceps__]  â”‚
â”‚                                 â”‚
â”‚  Notes (Optional)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Felt strong today, focus  â”‚ â”‚
â”‚  â”‚ on progressive overload.  â”‚ â”‚
â”‚  â”‚                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  125/500 characters            â”‚ â† Counter
â”‚                                 â”‚
â”‚  Exercises (5):                 â”‚
â”‚  ...                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Multiline TextField:**
- Min lines: 3
- Max lines: 5 (scrollable if more)
- Max length: 500 characters
- Hint: "Add notes about this workout..."

### Notes Display in List
**Source:** [PRD Feature 1 - US-1.5 AC]

**Option 1: Icon indicator**
```
Workout List Item:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Push Day               ğŸ“       â”‚ â† Icon if notes present
â”‚ 5 exercises                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Option 2: Preview text**
```
Workout List Item:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Push Day                        â”‚
â”‚ 5 exercises                     â”‚
â”‚ ğŸ“ "Felt strong today, focus..."â”‚ â† Truncated preview
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Recommendation:** Option 2 for more context

### Character Limit
**Source:** [PRD Feature 1 - US-1.5 AC]

**500 characters:**
- Sufficient for workout notes
- ~75-100 words
- Prevents overly long entries
- Database-friendly

**Implementation:**
```dart
TextField(
  maxLength: 500,
  maxLengthEnforcement: MaxLengthEnforcement.enforced,
  decoration: InputDecoration(
    labelText: 'Notes (Optional)',
    hintText: 'Add notes about this workout...',
    counterText: '', // Or show custom counter
  ),
  maxLines: 5,
  minLines: 3,
)
```

### Notes Preview Truncation
**Source:** [PRD Feature 1 - US-1.5 AC]

**Truncate long notes:**
```dart
String getNotesPreview(String notes) {
  const maxLength = 50;
  if (notes.length <= maxLength) return notes;
  return '${notes.substring(0, maxLength)}...';
}
```

**Display:**
- "Felt strong today, focus on progressive overload..."
- First 50 characters + ellipsis

### Use Cases for Notes
**Source:** [PRD Feature 1 - US-1.5]

**Examples:**
- "Focus on form today"
- "Add weight to bench press"
- "Shoulders feeling sore, go light"
- "Push for PRs on squats"
- "Deload week - reduce volume 20%"

**Benefits:**
- Context for future sessions
- Remind user of goals
- Track feelings/energy
- Adjust based on conditions

### Database (Already Exists)
**Source:** [PRD Feature 1 - Technical Specifications]

**Table: workouts**
- `notes TEXT` column already exists

### Performance
**Source:** [PRD Feature 1 - US-1.5]

- **Text input:** Instant
- **Character counting:** Real-time (no lag)
- **Save notes:** < 50ms (part of workout save)

### Dependencies
**Source:** [PRD Technical Architecture]

Packages (already in project):
- `flutter_bloc: ^8.1.0`
- `sqflite: ^2.3.0`

### Testing Standards

**Coverage Target:** >80%

**Key Test Cases:**
- Notes field accepts input
- Character limit enforced at 500
- Notes saved with workout
- Notes displayed in list
- Notes preview truncated correctly
- Null notes handled (optional field)

### Integration with Other Stories
**Dependencies:**
- Story 1.1 (Create Workout) - Notes field in entity
- Story 1.3 (Edit Workout) - Can edit notes

**Enables:**
- Better workout documentation
- Context for future sessions
- Personalization

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-11 | 1.0 | Initial story creation from PRD | Mathis (PM) |

---

## Dev Agent Record

### Agent Model Used
_To be filled by dev agent_

### Debug Log References
_To be filled by dev agent_

### Completion Notes List
_To be filled by dev agent_

### File List
_To be filled by dev agent_

---

## QA Results
_To be filled by QA agent_

